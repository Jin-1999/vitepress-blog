<!-- <style>
strong {
  color:#ff502c;
      background-color: #fff5f5;
}

</style> -->

## 浏览器的缓存机制

1. 浏览器每次在发送请求的时候，都会在浏览器缓存中查看该请求的结果以及缓存标识。
2. 浏览器每次拿到请求返回的结果时，都会将该响应和缓存标识存入浏览器缓存中。
3. 浏览器缓存分为**强缓存**和**协商缓存**，强制缓存优先于协商缓存，若强缓存生效则直接使用强缓存，若强缓存不生效则进行协商缓存。

## 浏览器缓存的过程

假设服务端都设置了`Cache-Control`,`last-modified`等响应头。

1. 浏览器第一次发送请求获取资源，服务器成功响应返回 200，浏览器将资源下载并将**响应头 response header 和请求返回的时间一并缓存下来**。
2. 在下一次加载相同请求的时候，**比较当前客户端时间和上次缓存的时间差是超过了响应头 Cache-Control 设置的 max-age 值（或者是本地时间有没有超过 expires 设置的时间）**，如果没有超过则命中强缓存，直接从本地缓存中获取该请求的资源；如果时间差超过了 max-age 值，则代表已经过期了，如果设置了协商缓存则继续判断协商缓存是否生效...
3. 服务器端设置`last-modified`(文件最后修改时间),或者`etag`(根据文件内容生成的 hash 值)两个响应头去控制协商缓存，前者客户端请求头会带上`If-Modified-Since`,后者请求头会带上`If-None-Match`，**服务器接收到请请求，对比响应两个字段是否相同，相同则命中协商缓存，返回 304；如果不一致则代表有改动，返回新的资源并附上新的`last-modified`或者`etag`值返回 200。**

## 强缓存

强缓存可以通过设置 Expires 和 Cache-Control 两个响应头去操控，强缓存并不会向服务器真正发送请求(直接浏览器返回资源)。

- Expires
  http/1.0，代表服务端的时间，判断请求的时候客户端时间去该值是否超出来判断是否强缓存生效。缺点是改变客户端时间可能会造成缓存失效。
- Cache-Control
  http/1.1，优先级高于 Expires；通常会有字段如 max-age:3600，代表 3600s 后过期，在 3600s 一直强缓存生效。`Cache-Control` 首部字段是 `HTTP/1.1` 中定义缓存的字段，其用于控制缓存的行为，可以组合使用多种指令，多个指令之间可以通过 “,” 分隔
  `Cache-Control: max-age:3600, s-maxage=3600, public`
  `Cache-Control: no-cache`
- `max-age` 指令 给出了缓存过期的相对时间，单位为秒数。时间是相对于请求的时间。
- `s-maxage`指令 与 `max-age` 不同之处在于，其只适用于公共缓存服务器，比如资源从源服务器发出后又被中间的代理服务器接收并缓存。当使用 `s-maxage` 指令后，公共缓存服务器将直接忽略 `Expires` 和 `max-age`指令的值。
- `public` 指令表示该资源可以被任何节点缓存（包括客户端和代理服务器）
- `private` 指令表示该资源只提供给客户端缓存，代理服务器不会进行缓存。同时当设置了 `private` 指令后 `s-maxage` 指令将被忽略。

### 关于 Cache-Control 属性

## 协商缓存
